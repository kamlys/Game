@model Game.GUI.ViewModels.Message.MessageViewModel
@using PagedList.Mvc;
@{
    Layout = null;
}


<div class="receivedMessage" id="receivedMessage">
    @if (!Model.pagedList.Any())
    {
        <span class="noRow">Brak wiadomości</span>
    }
    else
    {
        <table class="bordered centered">
            <thead>
                <tr>
                    <th>Nadawca</th>
                    <th>Temat</th>
                    <th>Data wysłania</th>
                    <th></th>
                </tr>
            </thead>

            <tbody id="receivedMessage">
                @foreach (var item in Model.pagedList)
                {
                    if (item.IfRead == false)
                    {
                        <tr id="newMessage">
                            <td>@Html.DisplayFor(modelItem => item.Sender_Login)</td>
                            <td onclick="location.href='@Url.Action("Content", "Message", new { MessageID = @item.ID })'">@Html.DisplayFor(modelItem => item.Theme)</td>
                            <td>@Html.DisplayFor(modelItem => item.PostDate)</td>
                            <td><button class="btn deleteM" data-messageID="@item.ID"><i class="fa fa-trash"></i></button></td>
                        </tr>
                    }
                    else if (item.IfRead == true)
                    {
                        <tr style="font-weight: normal">
                            <td>@Html.DisplayFor(modelItem => item.Sender_Login)</td>
                            <td onclick="location.href='@Url.Action("Content", "Message", new { MessageID = @item.ID })'">@Html.DisplayFor(modelItem => item.Theme)</td>
                            <td>@Html.DisplayFor(modelItem => item.PostDate)</td>
                            <td><button class="btn deleteM" data-messageID="@item.ID"><i class="fa fa-trash"></i></button></td>
                        </tr>
                    }
                }
            </tbody>
        </table>
        <div class="paginationBtn" id="paginationBtnReceived">
            @Html.PagedListPager(Model.pagedList, Page_No => Url.Action("_ReceivedMessage", new { Page_No }), PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(new AjaxOptions() { HttpMethod = "GET", UpdateTargetId = "receivedMessage" }))
        </div>
    }
</div>
<script>

    function init(){
        $(".deleteM").click(function(){
            console.log($(this).data('messageid'));
            $.ajax({
                type: "POST",
                url: 'Message/DeleteMessage',
                data: {a: $(this).data('messageid') },
                success: function (data) {
                    console.log(data);
                    $("#receivedMessage").html($(data).html());
                    init();
                }
            });
        });


        $('#paginationBtnReceived').on('click', 'a', function (e) {
            e.preventDefault();
            if (!$(this).parents("li:first").hasClass("active")) {
                $.ajax({
                    url: this.href,
                    type: 'GET',
                    cache: false,
                    success: function (result) {
                        $('#receivedMessage').html(result);
                        init();
                    }
                });
            }
        });
    }


    $(document).ready(function(){
        init();
    });

    //$(".deleteM").click(function(){
    //    console.log($(this).data('messageid'));
    //    $.ajax({
    //        type: "POST",
    //        url: 'Message/DeleteMessage',
    //        data: {a: $(this).data('messageid') },
    //        success: function (data) {
    //            console.log(data);
    //            $("#receivedMessage").html($(data).html());
    //        }
    //    });
    //});


    //$('#paginationBtnReceived').on('click', 'a', function (e) {
    //    e.preventDefault();
    //    if (!$(this).parents("li:first").hasClass("active")) {
    //        $.ajax({
    //            url: this.href,
    //            type: 'GET',
    //            cache: false,
    //            success: function (result) {
    //                $('#receivedMessage').html(result);
    //            }
    //        });
    //    }
    //});
</script>
